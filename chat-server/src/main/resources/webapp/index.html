<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Echo page</title>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
        var ws;

        const respStatus = {
            ok: "ok",
            notOk: "notOk",
            err: "err"
        };

        function login() {
            var username = $("#username").val();
            var password = $("#password").val();


            $.ajax({
                type: "POST",
                url: 'auth.action',
                dataType: 'json',
                // async: false,
                data: JSON.stringify({
                    username: username,
                    password: password
                }),
                success: function(data, status, jqXHR) {
                    console.log('status: ' + status + 'jqXHR: ' + jqXHR + ', data: ' + JSON.stringify(data));
                    var result = resultParse(data);
                    if (result.status) {
                        console.log(result.content);
                        // var respBody = JSON.parse(result.content);
                        redirect('chat.html', {
                            username: username,
                            token: result.content.token
                        });
                    } else {
                        alert(result.content);
                    }
                }
            });
        }

        function redirect(url, params) {
            window.location.replace(paramsToQuery(url, params));
        }

        function paramsToQuery(url, parmas) {
            var urlWithQuery = url;
            var index = 0;
            var count = Object.keys(parmas).length;
            for (var key in parmas) {
                if (parmas.hasOwnProperty(key)) {
                    console.log(key, parmas[key]);
                    if (index === 0) {
                        urlWithQuery = urlWithQuery + "?";
                    }
                    urlWithQuery = urlWithQuery + key + "=" + parmas[key];

                    if (index !== count - 1) {
                        urlWithQuery = urlWithQuery + "&";
                    }
                    index = index + 1;
                }
            }
            console.debug("url with query: " + urlWithQuery);
            return urlWithQuery;
        }

        function resultParse(data) {
            var jsonResult = JSON.stringify(data);
            console.log(jsonResult);
            var respDto = JSON.parse(jsonResult);
            if (respDto["status"] === respStatus.ok) {
                return {
                    status: true,
                    content: respDto["body"]
                };
            } else {
                return {
                    status: false,
                    content: respDto["errMessage"]
                }
            }

        }
    </script>
</head>

<body>



    <form>
        username: <input type="text" id="username" name="username" value="test" style="width: 200px">
        <p>
            password: <input type="password" id="password" name="password" value="123456" style="width: 200px">
            <p>
                <input type="button" onclick="login()" value="login" />

    </form>

</body>

</html>